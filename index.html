



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>pyfields</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#pyfields" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="pyfields" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              pyfields
            </span>
            <span class="md-header-nav__topic">
              
                Home
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/smarie/python-pyfields/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="." title="pyfields" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    pyfields
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/smarie/python-pyfields/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Home
      </label>
    
    <a href="." title="Home" class="md-nav__link md-nav__link--active">
      Home
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-defining-a-field" class="md-nav__link">
    1. Defining a field
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#field-vs-python-attribute" class="md-nav__link">
    Field vs. Python attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-value-factory" class="md-nav__link">
    Default value factory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-only-fields" class="md-nav__link">
    Read-only fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-validation" class="md-nav__link">
    Type validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nonable-fields" class="md-nav__link">
    Nonable fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-validation" class="md-nav__link">
    Value validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#converters" class="md-nav__link">
    Converters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#native-vs-descriptor-fields" class="md-nav__link">
    Native vs. Descriptor fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-adding-a-constructor" class="md-nav__link">
    2. Adding a constructor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-make_init" class="md-nav__link">
    a - make_init
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-init_fields" class="md-nav__link">
    b - @init_fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-misc" class="md-nav__link">
    3. Misc.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slots" class="md-nav__link">
    Slots
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features-benefits" class="md-nav__link">
    Main features / benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See Also
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    Others
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="why/" title="Why fields" class="md-nav__link">
      Why fields
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="api_reference/" title="API reference" class="md-nav__link">
      API reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-defining-a-field" class="md-nav__link">
    1. Defining a field
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#field-vs-python-attribute" class="md-nav__link">
    Field vs. Python attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-value-factory" class="md-nav__link">
    Default value factory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-only-fields" class="md-nav__link">
    Read-only fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-validation" class="md-nav__link">
    Type validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nonable-fields" class="md-nav__link">
    Nonable fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-validation" class="md-nav__link">
    Value validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#converters" class="md-nav__link">
    Converters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#native-vs-descriptor-fields" class="md-nav__link">
    Native vs. Descriptor fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-adding-a-constructor" class="md-nav__link">
    2. Adding a constructor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-make_init" class="md-nav__link">
    a - make_init
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-init_fields" class="md-nav__link">
    b - @init_fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-misc" class="md-nav__link">
    3. Misc.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slots" class="md-nav__link">
    Slots
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features-benefits" class="md-nav__link">
    Main features / benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See Also
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    Others
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/smarie/python-pyfields/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="pyfields">pyfields<a class="headerlink" href="#pyfields" title="Permanent link">&para;</a></h1>
<p><em>Define fields in python classes. Easily.</em></p>
<p><a href="https://pypi.python.org/pypi/pyfields/"><img alt="Python versions" src="https://img.shields.io/pypi/pyversions/pyfields.svg" /></a> <a href="https://travis-ci.org/smarie/python-pyfields"><img alt="Build Status" src="https://travis-ci.org/smarie/python-pyfields.svg?branch=master" /></a> <a href="https://smarie.github.io/python-pyfields/junit/report.html"><img alt="Tests Status" src="https://smarie.github.io/python-pyfields/junit/junit-badge.svg?dummy=8484744" /></a> <a href="https://codecov.io/gh/smarie/python-pyfields"><img alt="codecov" src="https://codecov.io/gh/smarie/python-pyfields/branch/master/graph/badge.svg" /></a></p>
<p><a href="https://smarie.github.io/python-pyfields/"><img alt="Documentation" src="https://img.shields.io/badge/doc-latest-blue.svg" /></a> <a href="https://pypi.python.org/pypi/pyfields/"><img alt="PyPI" src="https://img.shields.io/pypi/v/pyfields.svg" /></a> <a href="https://pepy.tech/project/pyfields"><img alt="Downloads" src="https://pepy.tech/badge/pyfields" /></a> <a href="https://pepy.tech/project/pyfields"><img alt="Downloads per week" src="https://pepy.tech/badge/pyfields/week" /></a> <a href="https://github.com/smarie/python-pyfields/stargazers"><img alt="GitHub stars" src="https://img.shields.io/github/stars/smarie/python-pyfields.svg" /></a></p>
<p><code>pyfields</code> provides a simple and elegant way to define fields in python classes. With <code>pyfields</code> you explicitly define all aspects of a field (default value, type, documentation...) in a single place, and can refer to it from other places.</p>
<p>It is designed with <strong>development freedom</strong> as primary target: </p>
<ul>
<li>
<p><em>code segregation</em>. Everything is in the field, not in <code>__init__</code>, not in <code>__setattr__</code>.</p>
</li>
<li>
<p><em>absolutely no constraints</em>. Your class does not need to use type hints. You can use python 2 and 3.5. Your class is not modified behind your back: <code>__init__</code> and <code>__setattr__</code> are untouched. You do not need to decorate your class. You do not need your class to inherit from anything. This is particularly convenient for mix-in classes, and in general for users wishing to stay in control of their class design.</p>
</li>
<li>
<p><em>no performance loss by default</em>. If you use <code>pyfields</code> to declare fields without adding validators nor converters, instance attributes will be replaced with a native python attribute on first access, preserving the same level of performance than what you are used to.</p>
</li>
</ul>
<p>It provides <strong>many optional features</strong> that will make your object-oriented developments easier:</p>
<ul>
<li>
<p>all field declarations support <em>type hints</em> and <em>docstring</em>,</p>
</li>
<li>
<p>optional fields can have <em>default values</em> but also <em>default values factories</em> (such as <em>"if no value is provided, copy this other field"</em>)</p>
</li>
<li>
<p>adding <em>validators</em> and <em>converters</em> to a field does not require you to write complex logic nor many lines of code. This makes field access obviously slower than the default native implementation but it is done field by field and not on the whole class at once, so fast native fields can coexist with slower validated ones (segregation principle).</p>
</li>
<li>
<p>initializing fields in your <em>constructor</em> is very easy and highly customizable</p>
</li>
</ul>
<p>If your first reaction is "what about <code>attrs</code> / <code>dataclasses</code> / <code>pydantic</code> / <code>characteristic</code> / <code>traits</code> / <code>traitlets</code> / <code>autoclass</code> / ...", please have a look <a href="why/">here</a>.</p>
<h2 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>&gt; pip install pyfields
</pre></div>


<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">compliance with python 2's old-style classes</p>
<p>All examples below assume python 3 and therefore show new-style classes without explicit inheritance of <code>object</code>, for readability. If you're using python 2 do not forget to explicitly use a new-style class otherwise some features will not be available (the ones where a setter on the field is required: validation, conversion, read-only).</p>
</div>
<h3 id="1-defining-a-field">1. Defining a field<a class="headerlink" href="#1-defining-a-field" title="Permanent link">&para;</a></h3>
<p>A field is defined as a class member using the <code>field()</code> method. The idea (not new) is that you declare in a single place all aspects related to each field. For mandatory fields you do not need to provide any argument. For optional fields, you will typically provide a <code>default</code> value or a <code>default_factory</code> (we will see that later).</p>
<p>For example let's create a <code>Wall</code> class with one <em>mandatory</em> <code>height</code> and one <em>optional</em> <code>color</code> field:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pyfields</span> <span class="kn">import</span> <span class="n">field</span>

<span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Color of the wall.&quot;</span><span class="p">)</span>
</pre></div>


<div class="admonition info">
<p class="admonition-title">Compliance with python &lt; 3.6</p>
<p>If you use python &lt; <code>3.6</code> you know that PEP484 type hints can not be declared as shown above. However you can provide them as <a href="https://www.python.org/dev/peps/pep-0484/#type-comments">type comments</a>, or using the <code>type_hint</code> argument.</p>
</div>
<h4 id="field-vs-python-attribute">Field vs. Python attribute<a class="headerlink" href="#field-vs-python-attribute" title="Permanent link">&para;</a></h4>
<p>By default when you use <code>field()</code>, nothing more than a "lazy field" is created on your class. This field will only be activated when you access it on an instance. That means that you are free to implement <code>__init__</code> as you wish, or even to rely on the default <code>object</code> constructor to create instances:</p>
<div class="codehilite"><pre><span></span><span class="c1"># instantiate using the default `object` constructor</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">Wall</span><span class="p">()</span>
</pre></div>


<p>No exception here even if we did not provide any value for the mandatory field <code>height</code> ! Although this default behaviour can look surprising, you will find that this feature is quite handy to define mix-in classes <em>with</em> attributes but <em>without</em> constructor. See <a href="https://smarie.github.io/python-mixture/">mixture</a> for discussion. Of course if you do not like this behaviour you can very easily <a href="#2-adding-a-constructor">add a constructor</a>.</p>
<p>Until it is accessed for the first time, a field is visible on an instance with <code>dir()</code> (because its definition is inherited from the class) but not with <code>vars()</code> (because it has not been initialized on the object):</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">dir</span><span class="p">(</span><span class="n">w</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
<span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">vars</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="p">{}</span>
</pre></div>


<p>As soon as you access it, a field is replaced with a standard native python attribute, visible in <code>vars</code>:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">w</span><span class="o">.</span><span class="n">color</span>  <span class="c1"># optional field: tdefault value is used</span>
<span class="s1">&#39;white&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">vars</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">}</span>
</pre></div>


<p>Of course mandatory fields must be initialized:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">w</span><span class="o">.</span><span class="n">height</span>
<span class="n">pyfields</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MandatoryFieldInitError</span><span class="p">:</span> \
   <span class="n">Mandatory</span> <span class="n">field</span> <span class="s1">&#39;height&#39;</span> <span class="n">has</span> <span class="ow">not</span> <span class="n">been</span> <span class="n">initialized</span> <span class="n">yet</span> <span class="n">on</span> <span class="n">instance</span> <span class="o">&lt;...&gt;.</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">12</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">vars</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
</pre></div>


<p>Your IDE (e.g. PyCharm) should recognize the name and type of the field, so you can already refer to it easily in other code using autocompletion:</p>
<p><img alt="pycharm_autocomplete1.png" src="imgs/autocomplete1.png" /></p>
<h4 id="default-value-factory">Default value factory<a class="headerlink" href="#default-value-factory" title="Permanent link">&para;</a></h4>
<p>We have seen above how to define an optional field by providing a default value. The behaviour with default values is the same than python's default: the same value is used for all objects. Therefore if your default value is a mutable object (e.g. a list) you should not use this mechanism, otherwise the same value will be shared by all instances that use the default:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">BadPocket</span><span class="p">:</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">BadPocket</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;thing&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span>
<span class="p">[</span><span class="s1">&#39;thing&#39;</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">g</span> <span class="o">=</span> <span class="n">BadPocket</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">items</span>
<span class="p">[</span><span class="s1">&#39;thing&#39;</span><span class="p">]</span>   <span class="c1"># &lt;--- this is not right ! </span>
</pre></div>


<p>To cover this use case and many others, you can use a "default value factory". A default value factory is a callable with a single argument: the object instance. It will be called everytime a default value is needed for a field on an object. You can either provide your own in the constructor:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Pocket</span><span class="p">:</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="p">[])</span>
</pre></div>


<p>or use the provided <code>@&lt;field&gt;.default_factory</code> decorator:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Pocket</span><span class="p">:</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">field</span><span class="p">()</span>

    <span class="nd">@items.default_factory</span>
    <span class="k">def</span> <span class="nf">default_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></div>


<p>Finally, you can use the following built-in helper functions to cover most common cases:</p>
<ul>
<li><code>copy_value(&lt;value&gt;)</code> returns a factory that will create copies of the value</li>
<li><code>copy_field(&lt;field_or_name&gt;)</code> returns a factory that will create copies of the given object field</li>
<li><code>copy_attr(&lt;attr_name&gt;)</code> returns a factory that will create copies of the given object attribute (not necessary a field)</li>
</ul>
<h4 id="read-only-fields">Read-only fields<a class="headerlink" href="#read-only-fields" title="Permanent link">&para;</a></h4>
<p>You can define fields that can only be set once:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;john&quot;</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;name: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;john2&quot;</span>
</pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span>name: john

pyfields.core.ReadOnlyFieldError: 
   Read-only field <span class="s1">&#39;&lt;...&gt;.User.name&#39;</span> has already been initialized on instance 
   &lt;&lt;...&gt;.User object at 0x000001CA70FA25F8&gt; and cannot be modified anymore.
</pre></div>


<p>Of course this makes more sense when an appropriate constructor is defined on the class as we'll see <a href="#2-adding-a-constructor">below</a>, but it also works independently.</p>
<p>Optional fields can also be "read-only" of course. But remember that in that case, <strong>reading</strong> the field on a brand new object will assign it to its default value - therefore is will not modifiable anymore:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;name: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;john&quot;</span>
</pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span>name: dummy

pyfields.core.ReadOnlyFieldError: 
   Read-only field <span class="s1">&#39;&lt;...&gt;.User.name&#39;</span> has already been initialized on instance 
   &lt;&lt;...&gt;.User object at 0x000001ED05E22CC0&gt; and cannot be modified anymore.
</pre></div>


<p>In practice if you have your own constructor or if you generate one using the methods <a href="#2-adding-a-constructor">below</a>, it will work without problem. But when debugging your constructor with an IDE that automatically calls "repr" on your object you might have to remember it and take extra care.</p>
<h4 id="type-validation">Type validation<a class="headerlink" href="#type-validation" title="Permanent link">&para;</a></h4>
<p>You can add type validation to a field by setting <code>check_type=True</code>.</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">check_type</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">check_type</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Color of the wall.&quot;</span><span class="p">)</span>
</pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="nv">w</span> <span class="o">=</span> <span class="nv">Wall</span><span class="ss">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nv">w</span>.<span class="nv">height</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nv">w</span>.<span class="nv">height</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">1</span><span class="s1">&#39;</span>
<span class="nv">TypeError</span>: <span class="nv">Invalid</span> <span class="nv">value</span> <span class="nv">type</span> <span class="nv">provided</span> <span class="k">for</span> <span class="s1">&#39;</span><span class="s">Wall.height</span><span class="s1">&#39;</span>. \ 
  <span class="nv">Value</span> <span class="nv">should</span> <span class="nv">be</span> <span class="nv">of</span> <span class="nv">type</span> <span class="s1">&#39;</span><span class="s">int</span><span class="s1">&#39;</span>. <span class="nv">Instead</span>, <span class="nv">received</span> <span class="nv">a</span> <span class="s1">&#39;</span><span class="s">str</span><span class="s1">&#39;</span>: <span class="s1">&#39;</span><span class="s">1</span><span class="s1">&#39;</span>
</pre></div>


<p>By default the type used for validation is the one provided in the annotation. If you use python &lt; <code>3.6</code> or wish to override the annotation, you can explicitly fill the <code>type_hint</code> argument in <code>field()</code>. It supports both a single type or an iterable of alternate types (e.g. <code>(int, str)</code>). Note that PEP484 type comments are not taken into account - indeed it is not possible for python code to access type comments without source code inspection.</p>
<div class="admonition success">
<p class="admonition-title">PEP484 <code>typing</code> support</p>
<p>Now type hints relying on the <code>typing</code> module (PEP484) are correctly checked using whatever 3d party type checking library is available (<code>typeguard</code> is first looked for, then <code>pytypes</code> as a fallback). If none of these providers are available, a fallback implementation is provided, basically flattening <code>Union</code>s and replacing <code>TypeVar</code>s before doing <code>is_instance</code>. It is not guaranteed to support all <code>typing</code> subtleties.</p>
</div>
<h4 id="nonable-fields">Nonable fields<a class="headerlink" href="#nonable-fields" title="Permanent link">&para;</a></h4>
<p><strong>Definition</strong></p>
<p>A <em>nonable</em> field is a field that can be set to <code>None</code>. It can be mandatory, or optional. By default, <code>pyfields</code> tries to guess if a field is <em>nonable</em> :</p>
<ul>
<li>
<p>if a type hint is provided and it is PEP484 <code>typing.Optional[...]</code>, then this explicitly means that the fields is <em>nonable</em>. (Note: the choice of this name <code>Optional</code> is terrible but it is like that, see <a href="https://github.com/python/typing/issues/275#issuecomment-244736968">this discussion</a></p>
</li>
<li>
<p>if the field is optional with a default value of <code>None</code>, then this implicitly means that the field is <em>nonable</em>. This is not the recommended way anymore but it has the advantage of being compact, so it is supported by <code>pyfields</code>.</p>
</li>
<li>
<p>in all other cases, <code>pyfields</code> can not really tell and sets the field to <em>nonable=UNKNOWN</em>. </p>
</li>
</ul>
<p>You can override this behaviour by explicitly stating <code>field(nonable=True)</code> or <code>field(nonable=False)</code>.</p>
<p>See also <a href="https://stackoverflow.com/questions/57390073/how-to-type-check-a-function-in-python3-that-has-an-optional-argument-initially/57390124#57390124">this stack overflow answer</a>.</p>
<p><strong>Effect</strong></p>
<p>When a field is known to be <em>nonable</em>, all of its type checks and validators are skipped when <code>None</code> is received.</p>
<p>When a field is forced explicitly to <code>nonable=False</code>, by default nothing happens, this is just declarative. However as soon as the field has type checking or validation activated, then a <code>NoneError</code> will be raised when <code>None</code> is received.</p>
<h4 id="value-validation">Value validation<a class="headerlink" href="#value-validation" title="Permanent link">&para;</a></h4>
<p>You can add value (and type) validation to a field by providing <code>validators</code>. <code>pyfields</code> relies on <code>valid8</code> for validation, so the basic definition of a validation function is the same: it should be a <code>&lt;callable&gt;</code> with signature <code>f(value)</code>, returning <code>True</code> or <code>None</code> in case of success. </p>
<p>A validator consists in a base validation function, with an optional error message and an optional failure type. To specify all these elements, the supported syntax is the same than in <code>valid8</code>:</p>
<ul>
<li>
<p>For a single validator, either provide a <code>&lt;callable&gt;</code> or a tuple <code>(&lt;callable&gt;, &lt;error_msg&gt;)</code>, <code>(&lt;callable&gt;, &lt;failure_type&gt;)</code> or <code>(&lt;callable&gt;, &lt;error_msg&gt;, &lt;failure_type&gt;)</code>. See <a href="https://smarie.github.io/python-valid8/validation_funcs/c_simple_syntax/#1-one-validation-function">here</a> for details.</p>
</li>
<li>
<p>For several validators, either provide a list or a dictionary. See <a href="https://smarie.github.io/python-valid8/validation_funcs/c_simple_syntax/#2-several-validation-functions">here</a> for details.</p>
</li>
</ul>
<p>An example is probably better to picture this:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">x</span>
<span class="kn">from</span> <span class="nn">valid8.validation_lib</span> <span class="kn">import</span> <span class="n">is_in</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;should be a positive number&#39;</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="s1">&#39;should be a multiple of 100&#39;</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> 
                        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="n">is_in</span><span class="p">(</span><span class="n">colors</span><span class="p">),</span> 
                       <span class="n">default</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> 
                       <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Color of the wall.&quot;</span><span class="p">)</span>
</pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="nv">w</span> <span class="o">=</span> <span class="nv">Wall</span><span class="ss">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nv">w</span>.<span class="nv">height</span> <span class="o">=</span> <span class="mi">100</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nv">w</span>.<span class="nv">height</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nv">valid8</span>.<span class="nv">entry_points</span>.<span class="nv">ValidationError</span>[<span class="nv">ValueError</span>]: 
    <span class="nv">Error</span> <span class="nv">validating</span> [<span class="o">&lt;</span>...<span class="o">&gt;</span>.<span class="nv">Wall</span>.<span class="nv">height</span><span class="o">=</span><span class="mi">1</span>]. 
    <span class="nv">At</span> <span class="nv">least</span> <span class="nv">one</span> <span class="nv">validation</span> <span class="nv">function</span> <span class="nv">failed</span> <span class="k">for</span> <span class="nv">value</span> <span class="mi">1</span>. 
    <span class="nv">Successes</span>: [<span class="s1">&#39;</span><span class="s">x &gt; 0</span><span class="s1">&#39;</span>] <span class="o">/</span> <span class="nv">Failures</span>: {
      <span class="s1">&#39;</span><span class="s">x % 100 == 0</span><span class="s1">&#39;</span>: <span class="s1">&#39;</span><span class="s">InvalidValue: should be a multiple of 100. Returned False.</span><span class="s1">&#39;</span>
    }.
<span class="o">&gt;&gt;&gt;</span> <span class="nv">w</span>.<span class="nv">color</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">magenta</span><span class="s1">&#39;</span>
<span class="nv">valid8</span>.<span class="nv">entry_points</span>.<span class="nv">ValidationError</span>[<span class="nv">ValueError</span>]: 
    <span class="nv">Error</span> <span class="nv">validating</span> [<span class="o">&lt;</span>...<span class="o">&gt;</span>.<span class="nv">Wall</span>.<span class="nv">color</span><span class="o">=</span><span class="nv">magenta</span>]. 
    <span class="nv">NotInAllowedValues</span>: <span class="nv">x</span> <span class="nv">in</span> {<span class="s1">&#39;</span><span class="s">blue</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">red</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">white</span><span class="s1">&#39;</span>} <span class="nv">does</span> <span class="nv">not</span> <span class="nv">hold</span> 
    <span class="k">for</span> <span class="nv">x</span><span class="o">=</span><span class="nv">magenta</span>. <span class="nv">Wrong</span> <span class="nv">value</span>: <span class="s1">&#39;</span><span class="s">magenta</span><span class="s1">&#39;</span>.
</pre></div>


<p>For advanced validation scenarios you might with your validation callables to receive a bit of context. <code>pyfields</code> supports that the callables accept one, two or three arguments for this (where <code>valid8</code> supports only 1): <code>f(val)</code>, <code>f(obj, val)</code>, and <code>f(obj, field, val)</code>.</p>
<p>For example we can define walls where the width is a multiple of the length:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">ValidationFailure</span>

<span class="k">class</span> <span class="nc">InvalidWidth</span><span class="p">(</span><span class="n">ValidationFailure</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;should be a multiple of the height ({height})&#39;</span>

<span class="k">def</span> <span class="nf">validate_width</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">width</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">height</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidWidth</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="n">validate_width</span><span class="p">,</span>
                       <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Width of the wall in mm.&quot;</span><span class="p">)</span>
</pre></div>


<p>Finally, in addition to the above syntax, <code>pyfields</code> support that you add validators to a field after creation, using the <code>@field.validator</code> decorator:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Width of the wall in mm.&quot;</span><span class="p">)</span>

    <span class="nd">@width.validator</span>
    <span class="k">def</span> <span class="nf">width_is_proportional_to_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width_value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">width_value</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidWidth</span><span class="p">(</span><span class="n">width_value</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</pre></div>


<p>As for all validators, the signature of the decorated function should be either <code>(value)</code>, <code>(obj/self, value)</code>, or <code>(obj/self, field, value)</code>.</p>
<p>Several such decorators can be applied on the same function, so as to mutualize implementation. In that case, you might wish to use the signature with 3 arguments so as to easily debug which field is being validated:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Width of the wall in mm.&quot;</span><span class="p">)</span>

    <span class="nd">@height.validator</span>
    <span class="nd">@width.validator</span>
    <span class="k">def</span> <span class="nf">width_is_proportional_to_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width_value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">width_value</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidWidth</span><span class="p">(</span><span class="n">width_value</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</pre></div>


<p>See <code>API reference</code> for details on <a href="#ltfieldgtvalidator"><code>@&lt;field&gt;.validator</code></a>.</p>
<p>See <code>valid8</code> documentation for details about the <a href="https://smarie.github.io/python-valid8/validation_funcs/c_simple_syntax/">syntax</a> and available <a href="https://smarie.github.io/python-valid8/validation_funcs/b_base_validation_lib/">validation lib</a>.</p>
<h4 id="converters">Converters<a class="headerlink" href="#converters" title="Permanent link">&para;</a></h4>
<p>You can add converters to a field by providing <code>converters</code>. </p>
<p>A <code>Converter</code> consists in a <em>conversion function</em>, with an optional <em>name</em>, and an optional <em>acceptance criterion</em>. </p>
<ul>
<li>
<p>The <em>conversion function</em> should be a callable with signature <code>f(value)</code>, <code>f(obj/self, value)</code>, or <code>f(obj/self, field, value)</code>, returning the converted value in case of success and raising an exception in case of converion failure. </p>
</li>
<li>
<p>The optional <em>acceptance criterion</em> can be a type, or a callable. When a type is provided, <code>isinstance</code> is used as the callable. The definition for the callable is exactly the same than for validation callables, see previous section. In addition, one can use a wildcard <code>'*'</code> or <code>None</code> to denote "accept everything". In that case acceptance is basically reduced to the conversion function raising exceptions when it can not convert values.</p>
</li>
</ul>
<p>To add converters on a field using <code>field(converters=...)</code>, the supported syntax is the following:</p>
<ul>
<li>
<p>For a single converter, either provide a <code>Converter</code>, a <code>&lt;conversion_callable&gt;</code>, a tuple <code>(&lt;accepted_type&gt;, &lt;conversion_callable&gt;)</code>, or a tuple <code>(&lt;acceptance_callable&gt;, &lt;conversion_callable&gt;)</code>. </p>
</li>
<li>
<p>For several converters, either provide a list of elements above, or a dictionary. In case of a dictionary, the key is <code>&lt;accepted_type&gt;</code>/<code>&lt;acceptance_callable&gt;</code>, and the value is <code>&lt;conversion_callable&gt;</code>.</p>
</li>
</ul>
<p>For example</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pyfields</span> <span class="kn">import</span> <span class="n">field</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">type_hint</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">type_hint</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> 
                                         <span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">})</span>
</pre></div>


<p>When a new value is set on a field, all of its converters are first scanned in order. Everytime a converter accepts a value, it is applied to convert it. The process stops at the first successful conversion, or after all converters have been tried. The obtained value (either the original one or the converted one) is then passed as usual to the validators (see previous section).</p>
<p>As for validators, you can easily define converters using a decorator <code>@&lt;field&gt;.converter</code>. As for all converters, the signature of the decorated function should be either <code>(value)</code>, <code>(obj/self, value)</code>, or <code>(obj/self, field, value)</code>.</p>
<p>Several such decorators can be applied on the same function, so as to mutualize implementation. In that case, you might wish to use the signature with 3 arguments so as to easily debug which field is being validated:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">type_hint</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">check_type</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">type_hint</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">check_type</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="nd">@m.converter</span><span class="p">(</span><span class="n">accepts</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@m2.converter</span>
    <span class="k">def</span> <span class="nf">from_anything</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;converting a value for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">field</span><span class="o">.</span><span class="n">qualname</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<p>You can check that everything works as expected:</p>
<div class="codehilite"><pre><span></span>&gt;&gt;&gt; <span class="nv">o</span> <span class="o">=</span> Foo<span class="o">()</span>
&gt;&gt;&gt; o.m2 <span class="o">=</span> <span class="s1">&#39;12&#39;</span>
converting a value <span class="k">for</span> Foo.m2
&gt;&gt;&gt; o.m2 <span class="o">=</span> <span class="m">1</span>.5
converting a value <span class="k">for</span> Foo.m2
&gt;&gt;&gt; o.m <span class="o">=</span> <span class="m">1</span>.5  <span class="c1"># doctest: +NORMALIZE_WHITESPACE</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
...
TypeError: Invalid value <span class="nb">type</span> provided <span class="k">for</span> <span class="s1">&#39;Foo.m&#39;</span>. Value should be of <span class="nb">type</span> &lt;class <span class="s1">&#39;int&#39;</span>&gt;.
  Instead, received a <span class="s1">&#39;float&#39;</span>: <span class="m">1</span>.5
</pre></div>


<p>Finally since debugging conversion issues might not be straightforward, a special <code>trace_convert</code> function is provided to output details about the outcome of each converter's acceptance and conversion step. This function is also available as a method of the field objects (obtained from the class).</p>
<div class="codehilite"><pre><span></span><span class="n">m_field</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span>
<span class="n">converted_value</span><span class="p">,</span> <span class="n">details</span> <span class="o">=</span> <span class="n">m_field</span><span class="o">.</span><span class="n">trace_convert</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>
</pre></div>


<h4 id="native-vs-descriptor-fields">Native vs. Descriptor fields<a class="headerlink" href="#native-vs-descriptor-fields" title="Permanent link">&para;</a></h4>
<p><code>field()</code> by default creates a so-called <strong>native field</strong>. This special construct is designed to be as fast as a normal python attribute after the first access, so that performance is not impacted. This high level of performance has a drawback: validation and conversion are not possible on a native field. </p>
<p>So when you add type or value validation, or conversion, to a field, <code>field()</code> will automatically create a <strong>descriptor field</strong> instead of a native field. This is an object relying on the <a href="https://docs.python.org/howto/descriptor.html">python descriptor protocol</a>. Such objects have slower access time than native python attributes but provide convenient hooks necessary to perform validation and conversion.</p>
<p>For experiments, you can force a field to be a descriptor by setting <code>native=False</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pyfields</span> <span class="kn">import</span> <span class="n">field</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">field</span><span class="p">()</span>               <span class="c1"># a native field</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">native</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>   <span class="c1"># a descriptor field</span>
</pre></div>


<p>We can easily see the difference (note: direct class access <code>Foo.a</code> is currently forbidden because of <a href="https://github.com/smarie/python-pyfields/issues/12">this issue</a>):</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">Foo</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="o">&lt;</span><span class="n">NativeField</span><span class="p">:</span> <span class="o">&lt;...&gt;.</span><span class="n">Foo</span><span class="o">.</span><span class="n">a</span><span class="o">&gt;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">Foo</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="o">&lt;</span><span class="n">DescriptorField</span><span class="p">:</span> <span class="o">&lt;...&gt;.</span><span class="n">Foo</span><span class="o">.</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>


<p>And measure the difference in access time:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">set_a</span><span class="p">():</span> <span class="n">f</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">12</span>

<span class="k">def</span> <span class="nf">set_b</span><span class="p">():</span> <span class="n">f</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">12</span>

<span class="k">def</span> <span class="nf">set_c</span><span class="p">():</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">ta</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">set_a</span><span class="p">)</span><span class="o">.</span><span class="n">timeit</span><span class="p">()</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">set_b</span><span class="p">)</span><span class="o">.</span><span class="n">timeit</span><span class="p">()</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">set_c</span><span class="p">)</span><span class="o">.</span><span class="n">timeit</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Average time (ns) setting the field:&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%0.2f</span><span class="s2"> (normal python) ; </span><span class="si">%0.2f</span><span class="s2"> (native field) ;&quot;</span> 
      <span class="s2">&quot; </span><span class="si">%0.2f</span><span class="s2"> (descriptor field)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">ta</span><span class="p">,</span> <span class="n">tb</span><span class="p">))</span>
</pre></div>


<p>yields (results depend on your machine):</p>
<div class="codehilite"><pre><span></span><span class="n">Average</span> <span class="n">time</span> <span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="n">setting</span> <span class="n">the</span> <span class="n">field</span><span class="p">:</span>
<span class="mi">0</span><span class="p">.</span><span class="mi">09</span> <span class="p">(</span><span class="n">normal</span> <span class="n">python</span><span class="p">)</span> <span class="p">;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">09</span> <span class="p">(</span><span class="n">native</span> <span class="n">field</span><span class="p">)</span> <span class="p">;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">44</span> <span class="p">(</span><span class="k">descriptor</span> <span class="n">field</span><span class="p">)</span>
</pre></div>


<div class="admonition info">
<p class="admonition-title">Why are native fields so fast ?</p>
<p>Native fields are implemented as a <a href="https://docs.python.org/3.7/howto/descriptor.html">"non-data" python descriptor</a> that overrides itself on first access. So the first time the attribute is read, a small python method call extra cost is paid but the attribute is immediately replaced with a normal attribute inside the object <code>__dict__</code>. That way, subsequent calls use native python attribute access without overhead. This trick was inspired by <a href="https://tedboy.github.io/flask/generated/generated/werkzeug.cached_property.html">werkzeug's @cached_property</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Adding validators or converters to native fields</p>
<p>If you run python <code>3.6</code> or greater and add validators or converters <strong>after</strong> field creation (typically using decorators), <code>field</code> will automatically replace the native field with a descriptor field. However with older python versions this is not always possible, so it is recommended that you explicitly state <code>native=False</code>.</p>
</div>
<h3 id="2-adding-a-constructor">2. Adding a constructor<a class="headerlink" href="#2-adding-a-constructor" title="Permanent link">&para;</a></h3>
<p><code>pyfields</code> provides you with several alternatives to add a constructor to a class equipped with fields. The reason why we do not follow the <a href="https://www.python.org/dev/peps/pep-0020/#the-zen-of-python">Zen of python</a> here (<em>"There should be one-- and preferably only one --obvious way to do it."</em>) is to recognize that different developers may have different coding style or philosophies, and to be as much as possible agnostic in front of these.</p>
<h4 id="a-make_init">a - <code>make_init</code><a class="headerlink" href="#a-make_init" title="Permanent link">&para;</a></h4>
<p><code>make_init</code> is the <strong>most compact</strong> way to add a constructor to a class with fields. With it you create your <code>__init__</code> method in one line:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pyfields</span> <span class="kn">import</span> <span class="n">field</span><span class="p">,</span> <span class="n">make_init</span>

<span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Color of the wall.&quot;</span><span class="p">)</span>
<span class="hll">    <span class="fm">__init__</span> <span class="o">=</span> <span class="n">make_init</span><span class="p">()</span>
</span></pre></div>


<p>By default, all fields will appear in the constructor, in the order of appearance in the class and its parents, following the <code>mro</code> (method resolution order, the order in which python looks for a method in the hierarchy of classes). Since it is not possible for mandatory fields to appear <em>after</em> optional fields in the signature, all mandatory fields will appear first, and then all optional fields will follow.</p>
<p>The easiest way to see the result is probably to look at the help on your class:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">help</span><span class="p">(</span><span class="n">Wall</span><span class="p">)</span>
<span class="n">Help</span> <span class="k">on</span> <span class="k">class</span> <span class="n">Wall</span> <span class="k">in</span> <span class="n">module</span> <span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span><span class="p">:</span>

<span class="k">class</span> <span class="n">Wall</span><span class="p">(</span><span class="n">builtins</span><span class="p">.</span><span class="k">object</span><span class="p">)</span>
<span class="hll"> <span class="o">|</span>  <span class="n">Wall</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</span> <span class="o">|</span>  <span class="p">(...)</span>
</pre></div>


<p>or you can inspect the method:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="nv">help</span><span class="ss">(</span><span class="nv">Wall</span>.<span class="nv">__init__</span><span class="ss">)</span>
<span class="nv">Help</span> <span class="nv">on</span> <span class="nv">function</span> <span class="nv">__init__</span> <span class="nv">in</span> <span class="nv">module</span> <span class="o">&lt;</span>...<span class="o">&gt;</span>:

<span class="hll"><span class="nv">__init__</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">height</span>, <span class="nv">color</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">white</span><span class="s1">&#39;</span><span class="ss">)</span>
</span>    <span class="nv">The</span> `<span class="nv">__init__</span>` <span class="nv">method</span> <span class="nv">generated</span> <span class="k">for</span> <span class="nv">you</span> <span class="nv">when</span> <span class="nv">you</span> <span class="nv">use</span> `<span class="nv">make_init</span>`
</pre></div>


<p>You can check that your constructor works as expected:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">Wall</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">vars</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">Wall</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">vars</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">Wall</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="fm">__init__</span><span class="p">()</span> <span class="n">missing</span> <span class="mi">1</span> <span class="n">required</span> <span class="n">positional</span> <span class="n">argument</span><span class="p">:</span> <span class="s1">&#39;height&#39;</span>
</pre></div>


<p>If you do not wish the generated constructor to expose all fields, you can customize it by providing an <strong>explicit</strong> ordered list of fields. For example below only <code>height</code> will be in the constructor:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pyfields</span> <span class="kn">import</span> <span class="n">field</span><span class="p">,</span> <span class="n">make_init</span>

<span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Color of the wall.&quot;</span><span class="p">)</span>

    <span class="c1"># only `height` will be in the constructor</span>
<span class="hll">    <span class="fm">__init__</span> <span class="o">=</span> <span class="n">make_init</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
</span></pre></div>


<p>The list can contain fields defined in another class, typically a parent class: </p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pyfields</span> <span class="kn">import</span> <span class="n">field</span><span class="p">,</span> <span class="n">make_init</span>

<span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ColoredWall</span><span class="p">(</span><span class="n">Wall</span><span class="p">):</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Color of the wall.&quot;</span><span class="p">)</span>
    <span class="fm">__init__</span> <span class="o">=</span> <span class="n">make_init</span><span class="p">(</span><span class="n">Wall</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</pre></div>


<p>Note: a pending <a href="https://github.com/smarie/python-pyfields/issues/12">issue</a> prevents the above example to work, you have to use <code>Wall.__dict__['height']</code> instead of <code>Wall.height</code> to reference the field from the other class.</p>
<p>Finally, you can customize the created constructor by declaring a post-init method as the <code>post_init_fun</code> argument. This is roughly equivalent to <code>@init_fields</code> so we do not present it here, see <a href="api_reference/#make_init">documentation</a>.</p>
<h4 id="b-init_fields">b - <code>@init_fields</code><a class="headerlink" href="#b-init_fields" title="Permanent link">&para;</a></h4>
<p>If you prefer to write an init function as usual, you can use the <code>@init_fields</code> decorator to augment this init function's signature with all or some fields.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pyfields</span> <span class="kn">import</span> <span class="n">field</span><span class="p">,</span> <span class="n">init_fields</span>

<span class="k">class</span> <span class="nc">Wall</span><span class="p">:</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Height of the wall in mm.&quot;</span><span class="p">)</span>  <span class="c1"># type: int</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Color of the wall.&quot;</span><span class="p">)</span>  <span class="c1"># type: str</span>

<span class="hll">    <span class="nd">@init_fields</span>
</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor. After initialization, some print message is done</span>

<span class="sd">        :param msg: the message details to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;post init ! height=</span><span class="si">%s</span><span class="s2">, color=</span><span class="si">%s</span><span class="s2">, msg=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_field_attr</span> <span class="o">=</span> <span class="n">msg</span>
</pre></div>


<p>Note: as you can see in this example, you can of course create other attributes in this init function (done in the last line here with <code>self.non_field_attr = msg</code>). Indeed, declaring fields in a class do not "pollute" the class, so you can do anything you like as usual.</p>
<p>You can check that the resulting constructor works as expected:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">help</span><span class="p">(</span><span class="n">Wall</span><span class="p">)</span>
<span class="n">Help</span> <span class="k">on</span> <span class="k">class</span> <span class="n">Wall</span> <span class="k">in</span> <span class="n">module</span> <span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span><span class="p">:</span>
<span class="k">class</span> <span class="n">Wall</span><span class="p">(</span><span class="n">builtins</span><span class="p">.</span><span class="k">object</span><span class="p">)</span>
 <span class="o">|</span>  <span class="n">Wall</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="p">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">Wall</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hey&#39;</span><span class="p">)</span>
<span class="n">post</span> <span class="n">init</span> <span class="o">!</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">hey</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">vars</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="err">{</span><span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;non_field_attr&#39;</span><span class="p">:</span> <span class="s1">&#39;hey&#39;</span><span class="err">}</span>
</pre></div>


<p>Note on the order of arguments in the resulting <code>__init__</code> signature: as you can see, <code>msg</code> appears between <code>height</code> and <code>color</code> in the signature. This corresponds to the </p>
<h3 id="3-misc">3. Misc.<a class="headerlink" href="#3-misc" title="Permanent link">&para;</a></h3>
<h4 id="slots">Slots<a class="headerlink" href="#slots" title="Permanent link">&para;</a></h4>
<p>You can use <code>pyfields</code> if your class has <code>__slots__</code>. You will simply have to use an underscore in the slot name corresponding to a field: <code>_&lt;field_name&gt;</code>. For example:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">WithSlots</span><span class="p">:</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_a&#39;</span><span class="p">,)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">field</span><span class="p">()</span>
</pre></div>


<p>Since from <a href="https://docs.python.org/3/reference/datamodel.html#slots">python documentation</a>, <em>"class attributes cannot be used to set default values for instance variables defined by <code>__slots__</code>"</em>, <strong>native fields are not supported with <code>__slots__</code></strong>. If you run python <code>3.6</code> or greater, <code>field</code> will automatically detect that a field is used on a class with <code>__slots__</code> and will replace the native field with a descriptor field. However with older python versions this is not always possible, so it is recommended that you explicitly state <code>native=False</code>.</p>
<p>Note that if your class is a dual class (meaning that it declares a slot named <code>__dict__</code>), then <strong>native fields are supported</strong> and you do not have anything special to do (not even declaring a slot for the field).</p>
<h2 id="main-features-benefits">Main features / benefits<a class="headerlink" href="#main-features-benefits" title="Permanent link">&para;</a></h2>
<p><strong>TODO</strong></p>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<p>This library was inspired by:</p>
<ul>
<li><a href="https://werkzeug.palletsprojects.com/en/0.15.x/utils/#werkzeug.utils.cached_property"><code>werkzeug.cached_property</code></a></li>
<li><a href="http://www.attrs.org/"><code>attrs</code></a></li>
<li><a href="https://docs.python.org/3/library/dataclasses.html"><code>dataclasses</code></a></li>
<li><a href="https://smarie.github.io/python-autoclass/"><code>autoclass</code></a></li>
<li><a href="https://pydantic-docs.helpmanual.io/"><code>pydantic</code></a></li>
</ul>
<h3 id="others">Others<a class="headerlink" href="#others" title="Permanent link">&para;</a></h3>
<p><em>Do you like this library ? You might also like <a href="https://github.com/smarie/OVERVIEW#python">my other python libraries</a></em> </p>
<h2 id="want-to-contribute">Want to contribute ?<a class="headerlink" href="#want-to-contribute" title="Permanent link">&para;</a></h2>
<p>Details on the github page: <a href="https://github.com/smarie/python-pyfields">https://github.com/smarie/python-pyfields</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="why/" title="Why fields" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Why fields
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>